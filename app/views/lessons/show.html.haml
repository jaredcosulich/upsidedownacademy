- @title = "#{@lesson.title} - #{@lesson.subject} > #{@lesson.specific_subject}"
- @description = truncate(@lesson.body, :length => 300)

%p
  = @lesson.subject
  - if @lesson.specific_subject.present?
    \>
    = @lesson.specific_subject

.lesson
  %p.right= link_to('Edit lesson >', edit_lesson_path(@lesson)) if lesson_owner?(@lesson)
  %h2= @lesson.title

  .lesson_info
    .right
      = render "lessons/status"

    %b Created by:
    %span.normal= link_to_unless(@lesson.user.nil?, lesson_owner(@lesson), profile_path(@lesson.user))

    %br

    %b
      = "#{lesson_owner(@lesson)}'s"
      confidence with
      = "#{(@lesson.specific_subject || @lesson.subject).downcase}:"
    = @lesson.confidence_text

  .photos_and_videos.right    
    - if @lesson.videos.empty? && @lesson.photos.empty?
      %p No videos or images have been added to this lesson.
      - if lesson_owner?(@lesson)
        %p= link_to("Add a video to your lesson >", new_lesson_video_path(@lesson), :class => "lightbox")
        %p= link_to("Add a photo/image/drawing to your lesson >", new_lesson_photo_path(@lesson), :class => "lightbox")

    - @lesson.videos.each do |video|
      .video
        %p.small.right= link_to("View&nbsp;larger&nbsp;video&nbsp;>".html_safe, lesson_video_path(@lesson, video), :class => "lightbox")
        %h4
          = truncate(video.title, :length => 39)
        = render "videos/video", :video => video, :size => :medium
        .small= simple_format(video.caption)

    - @lesson.photos.each do |photo|
      .photo
        %h4= photo.title
        = link_to(image_tag(photo.image.url), lesson_photo_path(@lesson, photo), :class => "lightbox")
        .small= simple_format(photo.caption)

  .lesson_text
    = simple_format(@lesson.body).html_safe


  .references
    %h3 Reference Material
    %p The following sources were helpful when I was learning this material.
    - if @lesson.references.empty?
      No references were used in learning the material.
    - else
      %ul
        - @lesson.references.each do |reference|
          %li
            = link_to_unless(reference.url.blank?, reference.title, reference.url, :target => "_blank")
            .small= simple_format(reference.comment)
    - if lesson_owner?(@lesson)
      %p= link_to("Add reference material for your lesson >", new_lesson_reference_path(@lesson), :class => "lightbox")

  .comments
    %h3 Comments On This Lesson
    - @lesson.comments.each do |comment|
      .comment
        = simple_format(comment.text)
        .small= "- from #{link_to(comment.user.display_name, profile_path(comment.user))}".html_safe
    = render "comments/form"
